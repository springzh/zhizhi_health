# 微信小程序调试指南

## 网络连接问题排查

### 1. 确认后端服务运行状态
```bash
# 检查后端服务是否运行
curl http://127.0.0.1:3001/api/health
```

### 2. 微信开发者工具设置

在微信开发者工具中，请确保以下设置正确：

#### 开发环境设置
1. 打开微信开发者工具
2. 点击右上角「详情」
3. 选择「本地设置」
4. 勾选以下选项：
   - ☑️ 不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书
   - ☑️ 允许 HTTP 请求

#### 网络设置
1. 在「设置」->「项目设置」中
2. 确认「基础库版本」选择较新版本（建议 2.0+）

### 3. 查看控制台日志

在微信开发者工具中：
1. 打开「Console」面板
2. 查看 API 请求日志
3. 查看网络请求状态

### 4. 常见错误及解决方案

#### 错误：request:fail url not in domain list
**原因**：域名未在微信后台配置
**解决**：在开发环境中勾选「不校验合法域名」

#### 错误：request:fail connection refused
**原因**：后端服务未启动或端口错误
**解决**：确认后端服务在 3001 端口运行

#### 错误：request:fail timeout
**原因**：网络请求超时
**解决**：检查网络连接，确认后端服务响应正常

### 5. 手动测试API连接

在浏览器或Postman中测试：
- 健康检查：http://127.0.0.1:3001/api/health
- 医生列表：http://127.0.0.1:3001/api/doctors
- 服务列表：http://127.0.0.1:3001/api/services
- FAQ列表：http://127.0.0.1:3001/api/faq

### 6. 调试步骤

1. **检查后端服务**：确认后端服务在 3001 端口运行
2. **检查开发者工具设置**：确认勾选了相关开发选项
3. **查看控制台日志**：检查 API 请求是否发送成功
4. **检查网络请求**：在 Network 面板查看请求状态
5. **检查响应数据**：确认 API 返回的数据格式正确

### 7. 如果问题仍然存在

1. 尝试重启微信开发者工具
2. 清除缓存并重新编译
3. 检查防火墙设置
4. 确认没有其他程序占用 3001 端口

## 当前配置

- API 基础URL：http://127.0.0.1:3001/api
- 后端端口：3001
- 请求超时：10秒
- 支持的API端点：
  - GET /api/health - 健康检查
  - GET /api/doctors - 医生列表
  - GET /api/services - 服务列表
  - GET /api/faq - FAQ列表
  - GET /api/faq/popular - 热门FAQ
  - GET /api/faq/categories - FAQ分类