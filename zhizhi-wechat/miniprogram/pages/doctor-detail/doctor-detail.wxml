<!--doctor-detail.wxml-->
<scroll-view class="container" scroll-y>
  <!-- 医生基本信息 -->
  <view class="doctor-profile" wx:if="{{!loading && doctor}}">
    <view class="doctor-header">
      <image class="doctor-avatar" src="{{doctor.avatar_url || '/images/default-avatar.png'}}" mode="aspectFill"></image>
      <view class="doctor-info">
        <text class="doctor-name">{{doctor.name}}</text>
        <text class="doctor-title">{{doctor.title}}</text>
        <text class="doctor-hospital">{{doctor.hospital}}</text>
        <view class="doctor-rating">
          <text class="rating-stars">⭐⭐⭐⭐⭐</text>
          <text class="rating-text">{{doctor.rating}}分</text>
          <text class="consultation-count">咨询{{doctor.consultation_count || 0}}次</text>
        </view>
      </view>
    </view>
    <view class="doctor-stats">
      <view class="stat-item">
        <text class="stat-number">{{doctor.experience}}</text>
        <text class="stat-label">从业经验</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{doctor.success_cases || '3.2k'}}</text>
        <text class="stat-label">成功案例</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{doctor.satisfaction || '98%'}}</text>
        <text class="stat-label">满意度</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{doctor.available_days || '2天'}}</text>
        <text class="stat-label">可预约</text>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 标签页 -->
  <view class="tabs" wx:if="{{!loading && doctor}}">
    <view class="tab {{activeTab === 'intro' ? 'active' : ''}}" bindtap="switchTab" data-tab="intro">医生简介</view>
    <view class="tab {{activeTab === 'services' ? 'active' : ''}}" bindtap="switchTab" data-tab="services">服务项目</view>
    <view class="tab {{activeTab === 'reviews' ? 'active' : ''}}" bindtap="switchTab" data-tab="reviews">患者评价</view>
    <view class="tab {{activeTab === 'schedule' ? 'active' : ''}}" bindtap="switchTab" data-tab="schedule">预约排班</view>
  </view>

  <!-- 标签页内容 -->
  <view class="tab-content" wx:if="{{!loading && doctor}}">
    <!-- 医生简介 -->
    <view class="tab-section {{activeTab === 'intro' ? 'active' : ''}}" id="intro">
      <view class="doctor-intro">
        <view class="section-title">医生简介</view>
        <text class="intro-text">{{doctor.introduction || '暂无简介'}}</text>
      </view>

      <view class="specialties">
        <view class="section-title">擅长领域</view>
        <view class="specialty-tags">
          <block wx:for="{{doctor.specialties || []}}" wx:key="*this">
            <text class="specialty-tag">{{item}}</text>
          </block>
        </view>
      </view>

      <view class="doctor-intro">
        <view class="section-title">学术背景</view>
        <text class="intro-text">{{doctor.education || '暂无学术背景信息'}}</text>
      </view>

      <view class="doctor-intro">
        <view class="section-title">医院地址</view>
        <text class="intro-text">{{doctor.address || '暂无地址信息'}}\n联系电话：{{doctor.contact_phone || '暂无'}}</text>
      </view>
    </view>

    <!-- 服务项目 -->
    <view class="tab-section {{activeTab === 'services' ? 'active' : ''}}" id="services">
      <view class="services">
        <view class="section-title">服务项目</view>
        <block wx:for="{{doctor.services || []}}" wx:key="id">
          <view class="service-item">
            <view class="service-info">
              <text class="service-name">{{item.name}}</text>
              <text class="service-desc">{{item.description}}</text>
            </view>
            <text class="service-price">{{item.price}}</text>
          </view>
        </block>
      </view>
    </view>

    <!-- 患者评价 -->
    <view class="tab-section {{activeTab === 'reviews' ? 'active' : ''}}" id="reviews">
      <view class="reviews">
        <view class="section-title">患者评价</view>
        <block wx:for="{{doctor.reviews || []}}" wx:key="id">
          <view class="review-item">
            <view class="review-header">
              <view class="reviewer-avatar">{{item.reviewer_name.charAt(0)}}</view>
              <view class="reviewer-info">
                <text class="reviewer-name">{{item.reviewer_name}}</text>
                <text class="review-date">{{item.date}}</text>
              </view>
              <text class="review-rating">⭐⭐⭐⭐⭐</text>
            </view>
            <text class="review-content">{{item.content}}</text>
          </view>
        </block>
      </view>
    </view>

    <!-- 预约排班 -->
    <view class="tab-section {{activeTab === 'schedule' ? 'active' : ''}}" id="schedule">
      <view class="schedule">
        <view class="section-title">预约排班</view>
        <view class="schedule-header">
          <view class="schedule-nav">
            <button class="schedule-btn {{scheduleWeek === 'this' ? 'active' : ''}}" bindtap="switchWeek" data-week="this">本周</button>
            <button class="schedule-btn {{scheduleWeek === 'next' ? 'active' : ''}}" bindtap="switchWeek" data-week="next">下周</button>
          </view>
        </view>
        <view class="schedule-date">
          <text class="date-text">{{scheduleDateRange}}</text>
        </view>
        <view class="time-slots">
          <block wx:for="{{timeSlots}}" wx:key="time">
            <view class="time-slot {{item.status}}" bindtap="selectTimeSlot" data-time="{{item.time}}" data-status="{{item.status}}">
              <text class="time-text">{{item.time}}</text>
            </view>
          </block>
        </view>
        <view class="schedule-legend">
          <text class="legend-text">🟢 可预约  🟠 已约满  ⚪ 休息时间</text>
        </view>
      </view>

      <view class="doctor-intro">
        <view class="section-title">预约须知</view>
        <text class="intro-text">• 请提前10分钟到达医院\n• 预约成功后会收到短信提醒\n• 如需取消预约，请提前24小时操作\n• 初诊患者请携带身份证件\n• 如有疑问，请致电医院咨询</text>
      </view>
    </view>
  </view>

  <!-- 底部预约栏 -->
  <view class="bottom-booking" wx:if="{{!loading && doctor}}">
    <view class="booking-price">
      <text class="price-label">咨询费用</text>
      <text class="price-value">{{doctor.consultation_price || '¥50起'}}</text>
    </view>
    <view class="booking-actions">
      <button class="booking-btn" bindtap="makeConsultation">咨询</button>
      <button class="booking-btn primary" bindtap="navigateToAppointment">预约</button>
    </view>
  </view>
</scroll-view>