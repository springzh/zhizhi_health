<!--doctor-detail.wxml-->
<scroll-view class="container" scroll-y>
  <!-- åŒ»ç”ŸåŸºæœ¬ä¿¡æ¯ -->
  <view class="doctor-profile" wx:if="{{!loading && doctor}}">
    <view class="doctor-header">
      <image class="doctor-avatar" src="{{doctor.avatar_url || '/images/default-avatar.png'}}" mode="aspectFill"></image>
      <view class="doctor-info">
        <text class="doctor-name">{{doctor.name}}</text>
        <text class="doctor-title">{{doctor.title}}</text>
        <text class="doctor-hospital">{{doctor.hospital}}</text>
        <view class="doctor-rating">
          <text class="rating-stars">â­â­â­â­â­</text>
          <text class="rating-text">{{doctor.rating}}åˆ†</text>
          <text class="consultation-count">å’¨è¯¢{{doctor.consultation_count || 0}}æ¬¡</text>
        </view>
      </view>
    </view>
    <view class="doctor-stats">
      <view class="stat-item">
        <text class="stat-number">{{doctor.experience}}</text>
        <text class="stat-label">ä»ä¸šç»éªŒ</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{doctor.success_cases || '3.2k'}}</text>
        <text class="stat-label">æˆåŠŸæ¡ˆä¾‹</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{doctor.satisfaction || '98%'}}</text>
        <text class="stat-label">æ»¡æ„åº¦</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{doctor.available_days || '2å¤©'}}</text>
        <text class="stat-label">å¯é¢„çº¦</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs" wx:if="{{!loading && doctor}}">
    <view class="tab {{activeTab === 'intro' ? 'active' : ''}}" bindtap="switchTab" data-tab="intro">åŒ»ç”Ÿç®€ä»‹</view>
    <view class="tab {{activeTab === 'services' ? 'active' : ''}}" bindtap="switchTab" data-tab="services">æœåŠ¡é¡¹ç›®</view>
    <view class="tab {{activeTab === 'reviews' ? 'active' : ''}}" bindtap="switchTab" data-tab="reviews">æ‚£è€…è¯„ä»·</view>
    <view class="tab {{activeTab === 'schedule' ? 'active' : ''}}" bindtap="switchTab" data-tab="schedule">é¢„çº¦æ’ç­</view>
  </view>

  <!-- æ ‡ç­¾é¡µå†…å®¹ -->
  <view class="tab-content" wx:if="{{!loading && doctor}}">
    <!-- åŒ»ç”Ÿç®€ä»‹ -->
    <view class="tab-section {{activeTab === 'intro' ? 'active' : ''}}" id="intro">
      <view class="doctor-intro">
        <view class="section-title">åŒ»ç”Ÿç®€ä»‹</view>
        <text class="intro-text">{{doctor.introduction || 'æš‚æ— ç®€ä»‹'}}</text>
      </view>

      <view class="specialties">
        <view class="section-title">æ“…é•¿é¢†åŸŸ</view>
        <view class="specialty-tags">
          <block wx:for="{{doctor.specialties || []}}" wx:key="*this">
            <text class="specialty-tag">{{item}}</text>
          </block>
        </view>
      </view>

      <view class="doctor-intro">
        <view class="section-title">å­¦æœ¯èƒŒæ™¯</view>
        <text class="intro-text">{{doctor.education || 'æš‚æ— å­¦æœ¯èƒŒæ™¯ä¿¡æ¯'}}</text>
      </view>

      <view class="doctor-intro">
        <view class="section-title">åŒ»é™¢åœ°å€</view>
        <text class="intro-text">{{doctor.address || 'æš‚æ— åœ°å€ä¿¡æ¯'}}\nè”ç³»ç”µè¯ï¼š{{doctor.contact_phone || 'æš‚æ— '}}</text>
      </view>
    </view>

    <!-- æœåŠ¡é¡¹ç›® -->
    <view class="tab-section {{activeTab === 'services' ? 'active' : ''}}" id="services">
      <view class="services">
        <view class="section-title">æœåŠ¡é¡¹ç›®</view>
        <block wx:for="{{doctor.services || []}}" wx:key="id">
          <view class="service-item">
            <view class="service-info">
              <text class="service-name">{{item.name}}</text>
              <text class="service-desc">{{item.description}}</text>
            </view>
            <text class="service-price">{{item.price}}</text>
          </view>
        </block>
      </view>
    </view>

    <!-- æ‚£è€…è¯„ä»· -->
    <view class="tab-section {{activeTab === 'reviews' ? 'active' : ''}}" id="reviews">
      <view class="reviews">
        <view class="section-title">æ‚£è€…è¯„ä»·</view>
        <block wx:for="{{doctor.reviews || []}}" wx:key="id">
          <view class="review-item">
            <view class="review-header">
              <view class="reviewer-avatar">{{item.reviewer_name.charAt(0)}}</view>
              <view class="reviewer-info">
                <text class="reviewer-name">{{item.reviewer_name}}</text>
                <text class="review-date">{{item.date}}</text>
              </view>
              <text class="review-rating">â­â­â­â­â­</text>
            </view>
            <text class="review-content">{{item.content}}</text>
          </view>
        </block>
      </view>
    </view>

    <!-- é¢„çº¦æ’ç­ -->
    <view class="tab-section {{activeTab === 'schedule' ? 'active' : ''}}" id="schedule">
      <view class="schedule">
        <view class="section-title">é¢„çº¦æ’ç­</view>
        <view class="schedule-header">
          <view class="schedule-nav">
            <button class="schedule-btn {{scheduleWeek === 'this' ? 'active' : ''}}" bindtap="switchWeek" data-week="this">æœ¬å‘¨</button>
            <button class="schedule-btn {{scheduleWeek === 'next' ? 'active' : ''}}" bindtap="switchWeek" data-week="next">ä¸‹å‘¨</button>
          </view>
        </view>
        <view class="schedule-date">
          <text class="date-text">{{scheduleDateRange}}</text>
        </view>
        <view class="time-slots">
          <block wx:for="{{timeSlots}}" wx:key="time">
            <view class="time-slot {{item.status}}" bindtap="selectTimeSlot" data-time="{{item.time}}" data-status="{{item.status}}">
              <text class="time-text">{{item.time}}</text>
            </view>
          </block>
        </view>
        <view class="schedule-legend">
          <text class="legend-text">ğŸŸ¢ å¯é¢„çº¦  ğŸŸ  å·²çº¦æ»¡  âšª ä¼‘æ¯æ—¶é—´</text>
        </view>
      </view>

      <view class="doctor-intro">
        <view class="section-title">é¢„çº¦é¡»çŸ¥</view>
        <text class="intro-text">â€¢ è¯·æå‰10åˆ†é’Ÿåˆ°è¾¾åŒ»é™¢\nâ€¢ é¢„çº¦æˆåŠŸåä¼šæ”¶åˆ°çŸ­ä¿¡æé†’\nâ€¢ å¦‚éœ€å–æ¶ˆé¢„çº¦ï¼Œè¯·æå‰24å°æ—¶æ“ä½œ\nâ€¢ åˆè¯Šæ‚£è€…è¯·æºå¸¦èº«ä»½è¯ä»¶\nâ€¢ å¦‚æœ‰ç–‘é—®ï¼Œè¯·è‡´ç”µåŒ»é™¢å’¨è¯¢</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨é¢„çº¦æ  -->
  <view class="bottom-booking" wx:if="{{!loading && doctor}}">
    <view class="booking-price">
      <text class="price-label">å’¨è¯¢è´¹ç”¨</text>
      <text class="price-value">{{doctor.consultation_price || 'Â¥50èµ·'}}</text>
    </view>
    <view class="booking-actions">
      <button class="booking-btn" bindtap="makeConsultation">å’¨è¯¢</button>
      <button class="booking-btn primary" bindtap="navigateToAppointment">é¢„çº¦</button>
    </view>
  </view>
</scroll-view>