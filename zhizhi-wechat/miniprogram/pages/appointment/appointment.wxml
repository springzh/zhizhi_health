<!--appointment.wxml-->
<view class="container">
  <!-- 步骤指示器 -->
  <view class="step-indicator">
    <view class="step {{currentStep >= 1 ? 'active' : ''}}">
      <view class="step-number">1</view>
      <text class="step-text">选择医生</text>
    </view>
    <view class="step-line"></view>
    <view class="step {{currentStep >= 2 ? 'active' : ''}}">
      <view class="step-number">2</view>
      <text class="step-text">选择服务</text>
    </view>
    <view class="step-line"></view>
    <view class="step {{currentStep >= 3 ? 'active' : ''}}">
      <view class="step-number">3</view>
      <text class="step-text">预约信息</text>
    </view>
  </view>

  <!-- 步骤1: 选择医生 -->
  <view class="step-content" wx:if="{{currentStep === 1}}">
    <view class="section-title">选择医生</view>
    <view class="doctor-grid">
      <block wx:for="{{doctors}}" wx:key="id">
        <view class="doctor-card {{selectedDoctor.id === item.id ? 'selected' : ''}}" bindtap="selectDoctor" data-id="{{item.id}}">
          <image class="doctor-avatar" src="{{item.avatar_url || '/images/default-avatar.png'}}" mode="aspectFill"></image>
          <text class="doctor-name">{{item.name}}</text>
          <text class="doctor-title">{{item.title}}</text>
          <text class="doctor-hospital">{{item.hospital}}</text>
          <view class="doctor-rating">
            <text class="rating-stars">⭐{{item.rating}}</text>
            <text class="rating-text">{{item.consultation_count || 0}}次咨询</text>
          </view>
        </view>
      </block>
    </view>
    
    <view class="step-actions">
      <button class="btn secondary" bindtap="goBack">返回</button>
      <button class="btn primary" bindtap="nextStep" disabled="{{!selectedDoctor.id}}">下一步</button>
    </view>
  </view>

  <!-- 步骤2: 选择服务 -->
  <view class="step-content" wx:if="{{currentStep === 2}}">
    <view class="selected-doctor">
      <image class="doctor-avatar" src="{{selectedDoctor.avatar_url || '/images/default-avatar.png'}}" mode="aspectFill"></image>
      <view class="doctor-info">
        <text class="doctor-name">{{selectedDoctor.name}}</text>
        <text class="doctor-title">{{selectedDoctor.title}}</text>
      </view>
    </view>
    
    <view class="section-title">选择服务</view>
    <view class="service-list">
      <block wx:for="{{services}}" wx:key="id">
        <view class="service-item {{selectedService.id === item.id ? 'selected' : ''}}" bindtap="selectService" data-id="{{item.id}}">
          <view class="service-info">
            <text class="service-name">{{item.name}}</text>
            <text class="service-desc">{{item.description}}</text>
            <text class="service-price">¥{{item.price}}</text>
          </view>
        </view>
      </block>
    </view>
    
    <view class="step-actions">
      <button class="btn secondary" bindtap="prevStep">上一步</button>
      <button class="btn primary" bindtap="nextStep" disabled="{{!selectedService.id}}">下一步</button>
    </view>
  </view>

  <!-- 步骤3: 预约信息 -->
  <view class="step-content" wx:if="{{currentStep === 3}}">
    <view class="appointment-summary">
      <view class="summary-item">
        <text class="summary-label">医生</text>
        <text class="summary-value">{{selectedDoctor.name}} {{selectedDoctor.title}}</text>
      </view>
      <view class="summary-item">
        <text class="summary-label">服务</text>
        <text class="summary-value">{{selectedService.name}} - ¥{{selectedService.price}}</text>
      </view>
    </view>
    
    <view class="section-title">预约信息</view>
    <view class="form-group">
      <view class="form-item">
        <text class="form-label">患者姓名 *</text>
        <input class="form-input" placeholder="请输入患者姓名" value="{{patientInfo.name}}" bindinput="onPatientInfoInput" data-field="name" />
      </view>
      <view class="form-item">
        <text class="form-label">联系电话 *</text>
        <input class="form-input" placeholder="请输入联系电话" type="number" value="{{patientInfo.phone}}" bindinput="onPatientInfoInput" data-field="phone" />
      </view>
      <view class="form-item">
        <text class="form-label">预约日期 *</text>
        <picker mode="date" bindchange="onDateChange" value="{{appointmentDate}}" start="{{minDate}}" end="{{maxDate}}">
          <view class="picker-input">{{appointmentDate || '请选择日期'}}</view>
        </picker>
      </view>
      <view class="form-item">
        <text class="form-label">预约时间 *</text>
        <picker mode="time" bindchange="onTimeChange" value="{{appointmentTime}}" start="08:00" end="18:00">
          <view class="picker-input">{{appointmentTime || '请选择时间'}}</view>
        </picker>
      </view>
      <view class="form-item">
        <text class="form-label">症状描述</text>
        <textarea class="form-textarea" placeholder="请简要描述您的症状..." value="{{symptoms}}" bindinput="onSymptomsInput"></textarea>
      </view>
    </view>
    
    <view class="step-actions">
      <button class="btn secondary" bindtap="prevStep">上一步</button>
      <button class="btn primary" bindtap="submitAppointment" disabled="{{loading}}">
        {{loading ? '提交中...' : '确认预约'}}
      </button>
    </view>
  </view>
</view>