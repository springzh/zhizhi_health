# 知治口腔服务平台 - 微信小程序需求文档

## 1. 小程序概述

### 1.1 项目定位
知治口腔服务平台微信小程序是基于微信生态的口腔医疗预约服务平台，为用户提供便捷的医生查找、在线预约、服务跟踪等功能。

### 1.2 核心价值
- 轻量级使用体验，无需下载安装
- 微信生态无缝衔接，支持微信登录和支付
- 地理位置服务，智能推荐附近医生
- 即时消息通知，预约状态实时更新

## 2. 功能模块

### 2.1 首页模块

#### 2.1.1 功能特性
- **轮播广告位**: 展示平台特色服务和活动
- **快速预约入口**: 显眼的预约按钮
- **推荐医生**: 根据地理位置推荐优质医生
- **服务分类**: 口腔检查、洗牙、治疗等分类入口
- **消息通知**: 预约状态和系统消息提醒
- **热门FAQ**: 展示常见问题解答
- **服务介绍**: 口腔服务项目展示
- **数据统计**: 平台医生数、成功案例等展示

#### 2.1.2 界面设计
```javascript
// 首页数据结构
{
  banners: [{
    id: number,
    image: string,
    link: string,
    title: string
  }],
  recommendedDoctors: Doctor[],
  serviceCategories: [{
    id: number,
    name: string,
    type: 'dental' | 'cell' | 'membership',
    icon: string
  }],
  popularFAQs: [{
    id: number,
    question: string,
    category: string
  }],
  statistics: {
    doctorCount: number,
    successCases: number,
    satisfaction: string,
    avgExperience: string
  }
}
```

#### 2.1.3 数据接口
```javascript
// 获取首页数据
GET /api/home
// 组合接口，包含推荐医生、服务分类、热门FAQ等

// 获取推荐医生
GET /api/doctors?limit=8&sort_by=rating&order=desc

// 获取服务分类
GET /api/services/categories

// 获取热门FAQ
GET /api/faq/popular?limit=5
```

### 2.2 医生模块

#### 2.2.1 医生列表
- **地区筛选**: 支持省市区三级联动选择
- **排序功能**: 按评分、距离、预约量排序
- **搜索功能**: 医生姓名、医院、专长关键词搜索
- **筛选条件**: 职称、服务项目、价格区间
- **服务类型**: 口腔修复、牙周治疗、牙齿美容等分类筛选
- **预约状态**: 显示医生可预约状态

#### 2.2.2 医生详情
- **基本信息**: 头像、姓名、职称、所属医院、地理位置
- **专业信息**: 擅长领域、从业年限、学术背景、咨询次数
- **服务项目**: 提供的具体服务项目和价格（consultation_price）
- **患者评价**: 真实用户评价和评分（rating系统）
- **预约排班**: 可预约的时间段展示
- **快速操作**: 预约咨询、查看详情按钮
- **联系信息**: 医院地址、联系方式等

#### 2.2.3 数据接口
```javascript
// 获取医生列表（支持搜索和筛选）
GET /api/doctors?page=1&limit=10&location=广州&specialty=口腔修复&search=关键词&sort_by=rating&order=desc

// 获取医生详情
GET /api/doctors/:id

// 获取医生服务类型
GET /api/doctors/:id/services
```

### 2.3 预约模块

#### 2.3.1 预约流程
1. 选择医生 → 2. 选择服务项目 → 3. 选择时间 → 4. 填写信息 → 5. 确认提交

#### 2.3.2 预约功能
- **医生选择**: 从医生列表选择或搜索特定医生
- **服务类型选择**: 基于医生擅长的服务项目（service_types）
- **时间选择**: 显示可用时间段，排除周末，智能推荐
- **患者信息**: 姓名、电话、邮箱、症状描述
- **预约须知**: 显示注意事项和费用信息
- **状态管理**: 待确认、已确认、已完成、已取消状态
- **消息通知**: 预约状态变更实时通知

#### 2.3.3 表单设计
```javascript
// 预约表单数据结构
{
  doctor_id: number,
  patient_name: string,
  patient_phone: string,
  patient_email: string,
  service_type: string,
  appointment_date: string, // YYYY-MM-DD
  appointment_time: string, // HH:mm
  symptoms: string, // 症状描述
  status: 'pending' | 'confirmed' | 'completed' | 'cancelled'
}
```

#### 2.3.4 数据接口
```javascript
// 创建预约
POST /api/appointments

// 获取用户预约列表
GET /api/appointments?user_id=:user_id&status=:status

// 获取预约详情
GET /api/appointments/:id

// 取消预约
PUT /api/appointments/:id/cancel

// 获取医生可用时间
GET /api/doctors/:id/availability?date=:date
```

### 2.4 我的模块

#### 2.4.1 个人中心
- **微信头像昵称**: 自动获取微信用户信息
- **我的预约**: 历史预约记录和当前预约状态
- **我的咨询**: 在线咨询记录和回复状态
- **我的收藏**: 收藏的医生列表
- **我的评价**: 已发布的评价记录
- **设置**: 通知设置、关于我们等

#### 2.4.2 预约管理
- **待确认**: 新提交的预约，等待医生确认
- **已确认**: 医生确认的预约，可查看详情
- **已完成**: 已完成的就诊，可进行评价
- **已取消**: 用户取消的预约，显示取消原因

#### 2.4.3 咨询管理
- **咨询列表**: 查看所有咨询记录
- **咨询状态**: 待回复、已回复、已完成
- **咨询详情**: 查看医生回复和沟通记录
- **新建咨询**: 快速发起新的咨询

#### 2.4.4 数据接口
```javascript
// 获取用户信息
GET /api/auth/me

// 更新用户信息
PUT /api/auth/profile

// 获取我的预约
GET /api/appointments?user_id=:user_id

// 获取我的咨询
GET /api/consultations?user_id=:user_id

// 获取收藏的医生
GET /api/users/:user_id/favorites

// 添加收藏医生
POST /api/users/:user_id/favorites/:doctor_id
```

### 2.5 服务介绍模块

#### 2.5.1 服务分类
- **口腔服务**: 洗牙、补牙、拔牙、根管治疗等
- **细胞治疗**: 相关的细胞治疗服务介绍
- **会员服务**: 会员专属服务和权益

#### 2.5.2 服务详情
- **服务说明**: 详细的服务内容介绍
- **适用人群**: 适合使用该服务的人群
- **注意事项**: 使用前需要注意的事项
- **价格信息**: 服务收费标准

#### 2.5.3 数据接口
```javascript
// 获取服务分类
GET /api/services/categories

// 根据类型获取服务分类
GET /api/services/categories/type/:type

// 获取服务详情
GET /api/services/:id

// 获取指定类型的服务
GET /api/services?type=dental
```

### 2.6 权益卡模块

#### 2.6.1 权益卡类型
- **护理卡**: 护理相关权益卡
- **特效药卡**: 特效药品权益卡
- **其他权益卡**: 其他类型的权益卡

#### 2.6.2 权益卡功能
- **权益卡列表**: 展示所有可用的权益卡
- **权益卡详情**: 详细权益说明和使用条件
- **购买功能**: 支持微信支付购买
- **我的权益卡**: 查看已购买的权益卡

#### 2.6.3 数据接口
```javascript
// 获取权益卡列表
GET /api/rights-cards/cards

// 根据类型获取权益卡
GET /api/rights-cards/cards/type/:type

// 获取可用权益卡
GET /api/rights-cards/cards/available

// 获取权益卡详情
GET /api/rights-cards/cards/:id
```

### 2.7 常见问题模块

#### 2.7.1 FAQ功能
- **分类展示**: 按类别分组显示问题
- **搜索功能**: 支持关键词搜索问题
- **展开收起**: 点击问题展开/收起答案
- **热门问题**: 优先显示热门问题

#### 2.7.2 数据接口
```javascript
// 获取FAQ分类
GET /api/faq/categories

// 获取FAQ列表
GET /api/faq?category=:category&limit=:limit

// 获取热门FAQ
GET /api/faq/popular

// 获取FAQ详情
GET /api/faq/:id
```

### 2.8 在线咨询模块

#### 2.8.1 咨询功能
- **咨询分类**: 按问题类型分类
- **咨询表单**: 标题、内容、匿名选项
- **咨询列表**: 查看历史咨询记录
- **咨询状态**: 待回复、已回复、已完成

#### 2.8.2 数据接口
```javascript
// 提交咨询
POST /api/consultations

// 获取咨询列表
GET /api/consultations?category=:category&page=:page

// 获取咨询详情
GET /api/consultations/:id

// 获取咨询分类
GET /api/consultations/categories
```

## 3. 技术实现

### 3.1 小程序框架
- **微信小程序原生框架**
- **WXML + WXSS + JavaScript**
- **使用Component组件化开发**
- **支持npm包管理**

### 3.2 状态管理
- **使用微信小程序自带的App/Page data**
- **简单的全局状态管理**
- **本地缓存存储用户数据**

### 3.3 网络请求
- **封装wx.request为Promise风格**
- **请求拦截器和错误处理**
- **接口签名和安全性保障**

### 3.4 第三方服务集成
- **微信登录**: `wx.login` + `wx.getUserInfo`
- **微信支付**: 预约费用支付功能
- **位置服务**: `wx.getLocation` 获取用户位置
- **消息模板**: 预约状态变更通知

## 4. 界面设计规范

### 4.1 设计系统
- **色彩规范**: 
  - 主色: #1E88E5 (医疗蓝)
  - 辅助色: #43A047 (健康绿)
  - 成功色: #4CAF50 (绿色)
  - 警告色: #FF9800 (橙色)
  - 错误色: #F44336 (红色)
  - 文字色: #333333, #666666, #999999
  - 背景色: #F5F5F5

- **字体规范**:
  - 大标题: 36rpx, 600
  - 标题: 32rpx, 600
  - 副标题: 28rpx, 500
  - 正文: 26rpx, normal
  - 辅助文字: 24rpx, normal
  - 提示文字: 22rpx, normal

- **间距规范**: 
  - 页面间距: 32rpx
  - 组件间距: 24rpx
  - 内间距: 16rpx
  - 小间距: 8rpx
  - 微小间距: 4rpx

### 4.2 组件库
- **按钮组件**: 主要按钮、次要按钮、文字按钮、危险按钮
- **表单组件**: 输入框、选择器、时间选择器、多行文本框
- **卡片组件**: 医生卡片、预约卡片、服务卡片、权益卡卡片
- **列表组件**: 医生列表、服务列表、FAQ列表、咨询列表
- **弹窗组件**: 确认弹窗、提示弹窗、加载弹窗、选择弹窗
- **加载组件**: 页面加载、下拉刷新、骨架屏
- **导航组件**: 底部导航栏、顶部导航栏、标签页

### 4.3 页面布局
- **首页布局**: 轮播图 + 快速入口 + 推荐医生 + 热门FAQ
- **列表页布局**: 搜索栏 + 筛选器 + 列表内容 + 分页
- **详情页布局**: 头部信息 + 标签页 + 详细内容 + 相关推荐
- **表单页布局**: 分步骤表单 + 实时验证 + 提交按钮
- **个人中心布局**: 用户信息 + 功能入口 + 列表内容

## 5. 接口设计

### 5.1 认证接口
```javascript
// 邮箱注册登录
POST /api/auth/register
{
  email: string,
  password: string,
  name: string
}

POST /api/auth/login
{
  email: string,
  password: string
}

// 微信登录（待实现）
POST /api/wx/login
{
  code: string // wx.login获取的code
}

// 获取用户信息
GET /api/auth/me
// 需要Authorization: Bearer token

// 更新用户信息
PUT /api/auth/profile
{
  name: string,
  phone?: string
}
```

### 5.2 医生接口
```javascript
// 获取医生列表（支持搜索、筛选、分页、排序）
GET /api/doctors?page=1&limit=10&location=广州&specialty=口腔修复&search=关键词&sort_by=rating&order=desc

// 获取医生详情
GET /api/doctors/:id

// 获取医生可用时间
GET /api/doctors/:id/availability?date=:date
```

### 5.3 服务接口
```javascript
// 获取服务分类
GET /api/services/categories

// 根据类型获取服务分类
GET /api/services/categories/type/:type // dental, cell, membership

// 获取服务分类详情
GET /api/services/categories/:id

// 获取服务列表
GET /api/services

// 获取会员卡列表
GET /api/membership
```

### 5.4 权益卡接口
```javascript
// 获取权益卡列表
GET /api/rights-cards/cards?page=1&limit=10&type=:type&is_available=true

// 获取可用权益卡
GET /api/rights-cards/cards/available

// 根据类型获取权益卡
GET /api/rights-cards/cards/type/:type // nursing, special_drug, other

// 获取权益卡详情
GET /api/rights-cards/cards/:id
```

### 5.5 预约接口
```javascript
// 创建预约
POST /api/appointments
{
  doctor_id: number,
  patient_name: string,
  patient_phone: string,
  patient_email: string,
  service_type: string,
  appointment_date: string,
  appointment_time: string,
  symptoms: string,
  status: 'pending'
}

// 获取预约列表
GET /api/appointments?user_id=:user_id&status=:status

// 获取预约详情
GET /api/appointments/:id

// 取消预约
PUT /api/appointments/:id/cancel
```

### 5.6 FAQ接口
```javascript
// 获取FAQ分类
GET /api/faq/categories

// 获取热门FAQ
GET /api/faq/popular

// 获取FAQ列表（支持分类和分页）
GET /api/faq?category=:category&limit=10&page=1

// 获取FAQ详情
GET /api/faq/:id
```

### 5.7 咨询接口
```javascript
// 提交咨询
POST /api/consultations
{
  category: string,
  title: string,
  content: string,
  isAnonymous: boolean
}

// 获取咨询列表
GET /api/consultations?category=:category&page=1

// 获取咨询详情
GET /api/consultations/:id

// 获取咨询分类
GET /api/consultations/categories
```

### 5.8 健康检查接口
```javascript
// 服务健康检查
GET /api/health
```

## 6. 数据存储

### 6.1 本地存储
- **wx.setStorageSync**: 存储用户token
- **wx.setStorageSync**: 存储用户基本信息
- **wx.setStorageSync**: 存储地区选择记录
- **wx.setStorageSync**: 存储搜索历史

### 6.2 缓存策略
- **医生列表缓存**: 5分钟有效期
- **医生详情缓存**: 10分钟有效期
- **预约数据**: 实时获取不缓存

## 7. 性能优化

### 7.1 加载优化
- **图片懒加载**: 使用wx.lazyLoadComponent
- **数据分页**: 列表数据分页加载
- **组件按需加载**: 使用分包加载

### 7.2 渲染优化
- **避免setData大数据**: 分字段更新
- **使用key属性**: 列表项唯一标识
- **减少不必要的渲染**: 使用hidden替代wx:if

## 8. 测试要求

### 8.1 功能测试
- 微信登录授权测试
- 地理位置获取测试
- 预约流程完整测试
- 支付功能测试（如涉及）

### 8.2 兼容性测试
- iOS/Android系统兼容
- 微信版本兼容（基础库版本）
- 不同屏幕尺寸适配

### 8.3 性能测试
- 首屏加载时间 < 1.5s
- 页面切换流畅
- 内存占用合理

## 9. 发布部署

### 9.1 开发流程
1. 开发环境配置
2. 功能开发实现
3. 测试验证
4. 体验版发布
5. 正式版审核

### 9.2 版本管理
- **版本号规范**: v1.0.0
- **更新日志**: 详细记录每次更新内容
- **回滚机制**: 紧急问题快速回滚

## 10. 运营维护

### 10.1 数据监控
- 用户访问数据统计
- 预约转化率分析
- 用户行为路径分析

### 10.2 用户反馈
- 小程序内反馈入口
- 客服联系方式
- 紧急问题处理流程

## 11. 当前实现状态

### 11.1 后端API状态
- ✅ **基础认证**: 邮箱注册/登录功能已实现
- ✅ **医生管理**: 医生列表和详情接口已实现，支持搜索、筛选、排序
- ✅ **服务管理**: 服务分类、会员卡、权益卡接口已实现
- ✅ **FAQ系统**: 分类、热门、详情接口已实现，支持搜索
- ✅ **预约系统**: 基础预约创建接口已实现
- ✅ **咨询系统**: 咨询提交和列表接口已实现
- ✅ **健康检查**: 服务健康检查接口已实现
- ⏳ **微信登录**: 需要实现微信OAuth集成
- ⏳ **预约管理**: 我的预约、取消预约需要完善
- ⏳ **用户中心**: 用户收藏、评价等功能需要实现
- ⏳ **权益卡购买**: 支付功能需要集成

### 11.2 前端网站状态
- ✅ **首页**: 轮播图、服务介绍、医生推荐、FAQ已实现
- ✅ **医生模块**: 医生列表、详情、搜索、筛选已实现
- ✅ **预约模块**: 通用预约页面已实现，支持医生选择和时间选择
- ✅ **FAQ模块**: FAQ页面已实现，支持分类筛选和搜索
- ✅ **服务介绍**: 口腔服务页面已实现
- ✅ **权益卡**: 权益卡页面已实现
- ✅ **咨询模块**: 在线咨询页面已实现
- ✅ **会员卡**: 会员卡页面已实现
- ✅ **用户中心**: 个人中心页面已实现

### 11.3 小程序状态
- ⏳ **基础框架**: 需要搭建小程序基础框架
- ⏳ **页面开发**: 所有页面需要适配小程序环境
- ⏳ **UI组件**: 需要基于设计系统开发小程序组件
- ⏳ **状态管理**: 需要实现小程序状态管理
- ⏳ **API集成**: 需要适配小程序的网络请求
- ⏳ **微信支付**: 需要集成微信支付功能
- ⏳ **微信登录**: 需要实现微信登录授权

### 11.4 数据库状态
- ✅ **表结构**: 完整的数据库表结构已设计
- ✅ **基础数据**: 医生、服务、FAQ等基础数据已存在
- ✅ **关系设计**: 合理的表关系和约束已建立
- ✅ **API支持**: 后端API已完整支持数据库操作

## 12. 实施建议

### 12.1 开发优先级
**第一阶段 (MVP)**
1. **基础框架**: 小程序基础框架搭建
2. **核心页面**: 首页、医生列表、医生详情
3. **核心功能**: 医生搜索、预约功能
4. **用户系统**: 微信登录、个人中心

**第二阶段**
1. **服务模块**: 服务介绍、权益卡展示
2. **FAQ系统**: 常见问题解答
3. **预约管理**: 我的预约、预约状态管理
4. **咨询系统**: 在线咨询功能

**第三阶段**
1. **支付功能**: 微信支付集成
2. **权益卡购买**: 权益卡购买功能
3. **消息通知**: 预约状态通知
4. **数据统计**: 用户行为分析

### 12.2 技术建议
- **组件复用**: 基于现有网站组件设计，适配小程序环境
- **状态管理**: 使用小程序原生状态管理，避免过度设计
- **网络请求**: 封装统一的请求处理，包含错误处理和loading状态
- **数据缓存**: 合理使用本地缓存，提升用户体验
- **性能优化**: 图片懒加载、分页加载、骨架屏等优化手段

### 12.3 注意事项
- **微信规范**: 严格遵循微信小程序开发规范和审核要求
- **用户体验**: 适配移动端操作习惯，简化操作流程
- **数据安全**: 用户数据加密存储，传输使用HTTPS
- **错误处理**: 完善的错误处理机制，友好的错误提示
- **测试覆盖**: 全面的功能测试和兼容性测试

### 12.4 上线准备
- **资质准备**: 医疗相关资质证明
- **服务协议**: 用户协议和隐私政策
- **客服支持**: 客服联系方式和处理流程
- **应急预案**: 系统故障和异常情况处理方案

---

*本文档版本: v3.0*
*最后更新: 2025-09-02*
*技术栈: 微信小程序原生开发*
*对接后端: Node.js + Express API + PostgreSQL*
*基于现有前端网站功能完善*