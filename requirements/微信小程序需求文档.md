# 知治口腔服务平台 - 微信小程序需求文档

## 1. 小程序概述

### 1.1 项目定位
知治口腔服务平台微信小程序是基于微信生态的口腔医疗预约服务平台，为用户提供便捷的医生查找、在线预约、服务跟踪等功能。

### 1.2 核心价值
- 轻量级使用体验，无需下载安装
- 微信生态无缝衔接，支持微信登录和支付
- 地理位置服务，智能推荐附近医生
- 即时消息通知，预约状态实时更新

## 2. 功能模块

### 2.1 首页模块

#### 2.1.1 功能特性
- **轮播广告位**: 展示平台特色服务和活动
- **快速预约入口**: 显眼的预约按钮
- **推荐医生**: 根据地理位置推荐优质医生
- **服务分类**: 口腔检查、洗牙、治疗等分类入口
- **消息通知**: 预约状态和系统消息提醒

#### 2.1.2 界面设计
```javascript
// 首页数据结构
{
  banners: [{
    image: string,
    link: string,
    title: string
  }],
  recommendedDoctors: Doctor[],
  serviceCategories: [{
    id: number,
    name: string,
    icon: string
  }],
  userAppointments: [{
    id: number,
    doctorName: string,
    appointmentTime: string,
    status: string
  }]
}
```

### 2.2 医生模块

#### 2.2.1 医生列表
- **地区筛选**: 支持省市区三级联动选择
- **排序功能**: 按评分、距离、预约量排序
- **搜索功能**: 医生姓名、医院、专长关键词搜索
- **筛选条件**: 职称、服务项目、价格区间

#### 2.2.2 医生详情
- **基本信息**: 头像、姓名、职称、所属医院
- **专业信息**: 擅长领域、从业年限、学术背景
- **服务项目**: 提供的具体服务项目和价格
- **患者评价**: 真实用户评价和评分
- **预约排班**: 可预约的时间段展示

### 2.3 预约模块

#### 2.3.1 预约流程
1. 选择医生 → 2. 选择服务项目 → 3. 选择时间 → 4. 填写信息 → 5. 确认提交

#### 2.3.2 表单设计
```javascript
// 预约表单数据结构
{
  doctorId: number,
  serviceType: string,
  appointmentDate: string, // YYYY-MM-DD
  appointmentTime: string, // HH:mm
  patientInfo: {
    name: string,
    phone: string,
    age: number,
    gender: string
  },
  symptoms: string, // 症状描述
  notes: string    // 补充信息
}
```

### 2.4 我的模块

#### 2.4.1 个人中心
- **微信头像昵称**: 自动获取微信用户信息
- **我的预约**: 历史预约记录和当前预约状态
- **我的收藏**: 收藏的医生列表
- **我的评价**: 已发布的评价记录
- **设置**: 通知设置、关于我们等

#### 2.4.2 预约管理
- **待确认**: 新提交的预约
- **已确认**: 医生确认的预约
- **已完成**: 已完成的就诊
- **已取消**: 用户取消的预约

## 3. 技术实现

### 3.1 小程序框架
- **微信小程序原生框架**
- **WXML + WXSS + JavaScript**
- **使用Component组件化开发**
- **支持npm包管理**

### 3.2 状态管理
- **使用微信小程序自带的App/Page data**
- **简单的全局状态管理**
- **本地缓存存储用户数据**

### 3.3 网络请求
- **封装wx.request为Promise风格**
- **请求拦截器和错误处理**
- **接口签名和安全性保障**

### 3.4 第三方服务集成
- **微信登录**: `wx.login` + `wx.getUserInfo`
- **微信支付**: 预约费用支付功能
- **位置服务**: `wx.getLocation` 获取用户位置
- **消息模板**: 预约状态变更通知

## 4. 界面设计规范

### 4.1 设计系统
- **色彩规范**: 
  - 主色: #1E88E5 (医疗蓝)
  - 辅助色: #43A047 (健康绿)
  - 文字色: #333333, #666666, #999999
  - 背景色: #F5F5F5

- **字体规范**:
  - 标题: 34rpx, 600
  - 正文: 28rpx, normal
  - 辅助文字: 24rpx, normal

- **间距规范**: 
  - 大间距: 32rpx
  - 中间距: 24rpx
  - 小间距: 16rpx
  - 微小间距: 8rpx

### 4.2 组件库
- **按钮组件**: 主要按钮、次要按钮、文字按钮
- **表单组件**: 输入框、选择器、时间选择器
- **卡片组件**: 医生卡片、预约卡片
- **弹窗组件**: 确认弹窗、提示弹窗
- **加载组件**: 页面加载、下拉刷新

## 5. 接口设计

### 5.1 认证接口
```javascript
// 邮箱注册登录
POST /api/auth/register
{
  email: string,
  password: string,
  name: string
}

POST /api/auth/login
{
  email: string,
  password: string
}

// 微信登录（待实现）
POST /api/wx/login
{
  code: string // wx.login获取的code
}

// 获取用户信息
GET /api/auth/me
// 需要Authorization: Bearer token

// 更新用户信息
PUT /api/auth/profile
{
  name: string,
  phone?: string
}
```

### 5.2 医生接口
```javascript
// 获取医生列表
GET /api/doctors?location=广州&page=1&limit=10&sort=rating

// 获取医生详情
GET /api/doctors/:id

// 搜索医生（待实现）
GET /api/doctors/search?q=关键词&specialty=牙科
```

### 5.3 服务接口
```javascript
// 获取服务列表
GET /api/services

// 获取服务分类
GET /api/services/categories

// 获取会员卡列表
GET /api/membership

// 获取权益卡列表
GET /api/rights-cards/cards
GET /api/rights-cards/cards/type/:type  // nursing, special_drug, other
```

### 5.4 预约接口
```javascript
// 创建预约
POST /api/appointments
{
  doctorId: number,
  serviceType: string,
  appointmentTime: string,
  patientInfo: object,
  notes: string
}

// 获取我的预约（待实现）
GET /api/appointments?status=confirmed

// 取消预约（待实现）
PUT /api/appointments/:id/cancel
```

### 5.5 FAQ接口
```javascript
// 获取FAQ分类
GET /api/faq/categories

// 获取热门FAQ
GET /api/faq/popular

// 获取FAQ列表
GET /api/faq?category=分类&limit=10

// 获取FAQ详情
GET /api/faq/:id
```

### 5.6 咨询接口
```javascript
// 提交咨询（待实现）
POST /api/consultations
{
  category: string,
  title: string,
  content: string,
  isAnonymous: boolean
}

// 获取咨询列表（待实现）
GET /api/consultations?category=分类&page=1
```

## 6. 数据存储

### 6.1 本地存储
- **wx.setStorageSync**: 存储用户token
- **wx.setStorageSync**: 存储用户基本信息
- **wx.setStorageSync**: 存储地区选择记录
- **wx.setStorageSync**: 存储搜索历史

### 6.2 缓存策略
- **医生列表缓存**: 5分钟有效期
- **医生详情缓存**: 10分钟有效期
- **预约数据**: 实时获取不缓存

## 7. 性能优化

### 7.1 加载优化
- **图片懒加载**: 使用wx.lazyLoadComponent
- **数据分页**: 列表数据分页加载
- **组件按需加载**: 使用分包加载

### 7.2 渲染优化
- **避免setData大数据**: 分字段更新
- **使用key属性**: 列表项唯一标识
- **减少不必要的渲染**: 使用hidden替代wx:if

## 8. 测试要求

### 8.1 功能测试
- 微信登录授权测试
- 地理位置获取测试
- 预约流程完整测试
- 支付功能测试（如涉及）

### 8.2 兼容性测试
- iOS/Android系统兼容
- 微信版本兼容（基础库版本）
- 不同屏幕尺寸适配

### 8.3 性能测试
- 首屏加载时间 < 1.5s
- 页面切换流畅
- 内存占用合理

## 9. 发布部署

### 9.1 开发流程
1. 开发环境配置
2. 功能开发实现
3. 测试验证
4. 体验版发布
5. 正式版审核

### 9.2 版本管理
- **版本号规范**: v1.0.0
- **更新日志**: 详细记录每次更新内容
- **回滚机制**: 紧急问题快速回滚

## 10. 运营维护

### 10.1 数据监控
- 用户访问数据统计
- 预约转化率分析
- 用户行为路径分析

### 10.2 用户反馈
- 小程序内反馈入口
- 客服联系方式
- 紧急问题处理流程

## 11. 当前实现状态

### 11.1 后端API状态
- ✅ **基础认证**: 邮箱注册/登录功能已实现
- ✅ **医生管理**: 医生列表和详情接口已实现
- ✅ **服务管理**: 服务列表、会员卡、权益卡接口已实现
- ✅ **FAQ系统**: 分类、热门、详情接口已实现
- ✅ **预约系统**: 基础预约创建接口已实现
- ⏳ **微信登录**: 需要实现微信OAuth集成
- ⏳ **搜索功能**: 医生搜索接口需要完善
- ⏳ **预约管理**: 我的预约、取消预约需要实现
- ⏳ **咨询系统**: 咨询提交和列表需要实现

### 11.2 小程序状态
- ⏳ **基础框架**: 已搭建，但功能页面需要实现
- ⏳ **页面开发**: 首页、医生、预约、个人中心等页面需要开发
- ⏳ **UI组件**: 需要统一的设计系统和组件库
- ⏳ **状态管理**: 需要实现用户状态和数据管理
- ⏳ **API集成**: 需要集成现有后端API

### 11.3 数据库状态
- ✅ **表结构**: 完整的数据库表结构已设计
- ✅ **基础数据**: 医生、服务、FAQ等基础数据已存在
- ✅ **关系设计**: 合理的表关系和约束已建立

---

*本文档版本: v2.0*
*最后更新: 2025-09-02*
*技术栈: 微信小程序原生开发*
*对接后端: Node.js + Express API + PostgreSQL*